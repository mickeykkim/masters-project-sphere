{% extends "base.html" %}

{% block title %}<title>Bristol Sphere PD Sensors - Wearable Data</title>{% endblock %}

{% block content %}
  <div class="titleText">
    <h1>Patient: <a href="{{ wearabledata.patient.get_absolute_url }}" data-toggle="tooltip" data-placement="bottom" data-trigger="hover"
                   title="Link to patient data page">{{ wearabledata.patient }}</a></h1>
    {% if perms.sensors.can_alter_wearabledata %}
      <button id="edit" class="titleButton controlButtonXL" data-toggle="tooltip" data-placement="bottom" data-trigger="hover"
              title="Edit Wearable Data"><i class="material-icons buttonIconS">create</i> Edit</button>
    {% endif %}
  </div>
  <p><em>Session Time:</em> {{ wearabledata.time }} <span class="vert-divider">|</span> <em>Note:</em> {{ wearabledata.note }}</p>
  <hr>
  <h1>Wearable Data Visualization</h1>
  <canvas id="myChart" width="500" height="400" style="margin-top: 25px"></canvas>
  <hr>
  <div style="margin-left:20px;margin-top:20px">
    <h4>Wearable Annotations
      <button id="import" class="controlButtonS" data-toggle="tooltip" data-placement="bottom"
              name=""
              data-trigger="hover" title="Import annotations"><i class="material-icons">cloud_upload</i></button>
    </h4>
    <ul>
      {% for annotation in wearabledata.w_annotations.all %}
        <li><a href="{% url 'wearableannotation-detail' wearabledata.id annotation.id %}">
          Frame: {{annotation.frame}} - {{annotation.get_annotation_display}} ({{annotation.get_status_display}})
        </a></li>
      {% endfor %}
    </ul>
  </div>
{% endblock %}

{% block javascript %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"
          integrity="sha384-QzN1ywg2QLsf72ZkgRHgjkB/cfI4Dqjg6RJYQUqH6Wm8qp/MvmEYn+2NBsLnhLkr"
          crossorigin="anonymous"></script>
{% endblock %}

{% block jquery %}
  $('[data-toggle="tooltip"]').tooltip();

  var ctx = document.getElementById('myChart').getContext('2d');
  var myChart = new Chart(ctx, {
     type: 'line',
     data: {
        labels: [{% for data in wearabledata.data_point.all %}'{{ data.frame }}', {% endfor %}],
        datasets: [{
           label: '',
           fill: true, // set to false for just line
           data: [{% for data in wearabledata.data_point.all %}{{ data.magnitude }}, {% endfor %}],
           backgroundColor: [
              'rgba(255, 99, 132, 0.2)',
           ],
           borderColor: [
              'rgba(255, 99, 132, 1)',
           ],
           borderWidth: 1
        }]
     },
     options: {
        responsive: true,
        legend: {
           display: false
        },
        tooltips: {
           callbacks: {
              label: function(tooltipItem) {
                 return tooltipItem.yLabel;
              }
           }
        },
        title: {
           display: false,
           text: ''
        },
        tooltips: {
           mode: 'index',
           intersect: false,
        },
        hover: {
           mode: 'nearest',
           intersect: true
        },
        /*
        elements: { d
          line: {
              tension: 0 // disables bezier curves for better performance with large amounts of data
          }
        },
        */
        scales: {
           xAxes: [{
              display: true,
              scaleLabel: {
                 display: true,
                 labelString: 'Frame'
              }
           }],
           yAxes: [{
              display: true,
              scaleLabel: {
                 display: true,
                 labelString: 'Average Magnitude'
              }
           }]
        }
     }
  });
{% endblock %}