{% extends "base.html" %}

{% block title %}
  <title>Bristol Sphere PD Sensors - Camera Data</title>
{% endblock %}

{% load static %}

{% block content %}
  <div class="titleText">
    <h1>Patient: {{ cameradata.patient }}</h1>
    <button id="edit" class="titleButton controlButtonXL" data-toggle="tooltip" data-placement="bottom" data-trigger="hover"
            title="Edit Camera Data"><i class="material-icons buttonIconS">create</i> Edit</button>
  </div>
  <p><em>Session Time:</em> {{ cameradata.time }}
    <span class="vert-divider">|</span>
    <em>Note:</em> {{ cameradata.note }}
    <span class="vert-divider">|</span>
    <button id="help" class="controlButtonM" data-toggle="tooltip" data-placement="bottom" data-trigger="hover"
            title="Display shortcut keys"><i class="material-icons">keyboard</i></button>
  </p>
  <hr>

  <div class="videoFrame">
    <!-- VideoFrame Object -->
    <video height="50%" width="100%" id="video" src="{{ media_url }}{{ cameradata.filename }}" type="video/mp4" playsinline></video>
    <!-- Play Controls -->
    <div id="play-controls" class="playControls">
      <button id="play-pause" class="controlButtonL"><i class="material-icons">play_arrow</i></button>
      <label for="seek-bar"></label><input type="range" id="seek-bar" class="seekBar" style="width:50%;margin:5px 0 0 5px;" min="0" value="0" step="1">
      <span id="video-time" class="timestamp">00:00</span><span class="timestamp">/</span><span id="video-duration" class="timestamp">00:00</span>
      <button id="mute" class="controlButtonL" data-toggle="tooltip" data-placement="bottom"
              data-trigger="hover" title="Toggle mute"><i class="material-icons">volume_up</i></button>
      <label for="volume-bar"></label><input type="range" id="volume-bar" class="volumeBar" style="width:10%;margin:5px 0 0 5px;" min="0" max="1" step="0.1" value="1"/>
    </div>
    <!-- Form  -->
    <div id="form-controls" class="formControls">
      <form method="POST" class="post-form">
        {% csrf_token %}
        <!-- Seek Controls -->
        <div class="seekControls">
          <input type="text" id="rewind-value" class="rewindTextValue" value=0 data-toggle="tooltip" data-placement="bottom"
                 title="Frame to jump back to">
          <button type="button" id="rewind-video" class="controlButtonM" data-toggle="tooltip" data-placement="bottom"
                  data-trigger="hover" title="Jump back to frame"><i class="material-icons">skip_previous</i></button>
          <span class="vert-divider">|</span>
          <span class="selectBox">
            <select id="backward-increment" class="dropDown" data-toggle="tooltip" data-placement="bottom"
                    data-trigger="hover" title="# of frames to step back">
              <option value="1">1</option>
              <option value="2">5</option>
              <option value="3">10</option>
              <option value="4">25</option>
              <option value="5">50</option>
              <option value="6">100</option>
            </select>
          </span>
          <button type="button" id="seek-backward" class="controlButtonM" data-toggle="tooltip" data-placement="bottom"
                  data-trigger="hover" title="Step backwards"><i class="material-icons">fast_rewind</i></button>
          <span class="vert-divider">|</span>
          <span class="selectBox">
            <select id="forward-increment" class="dropDown" data-toggle="tooltip" data-placement="bottom"
                    data-trigger="hover" title="# of frames to step forward">
              <option value="1">1</option>
              <option value="2">5</option>
              <option value="3">10</option>
              <option value="4">25</option>
              <option value="5">50</option>
              <option value="6">100</option>
            </select>
          </span>
          <button type="button" id="seek-forward" class="controlButtonM" data-toggle="tooltip" data-placement="bottom"
                  data-trigger="hover" title="Step forwards"><i class="material-icons">fast_forward</i></button>
          <span class="vert-divider">|</span>
          <!-- Form Controls -->
          <span class="selectBox" data-toggle="tooltip" data-placement="bottom"
                data-trigger="hover" title="Annotation activity category">
            {{ form.annotation }}
          </span>
          <span data-toggle="tooltip" data-placement="bottom" title="Annotation Note">
            {{ form.note }}
          </span>
          <span class="selectBox" data-toggle="tooltip" data-placement="bottom"
                data-trigger="hover" title="Activity begin (+) or end (-)">
            {{ form.status }}
          </span>
          <button type="submit" id="annotate" class="controlButtonM" data-toggle="tooltip" data-placement="bottom" data-trigger="hover"
                  title="Add annotation"><i class="material-icons">add</i></button>
        </div>
        <!-- Frame Details -->
        <div class="frameDetails">
          <label for="framerate-list">Framerate:&nbsp;</label>
          <span class="selectBox">
          <select id="framerate-list" data-toggle="tooltip" data-placement="bottom" data-trigger="hover"
                  title="Framerate options" class="fpsDropDown">
            <option value="1" selected>24</option>
            <option value="2">25</option>
            <option value="3">29.97</option>
            <option value="4">30</option>
            <option value="5">60</option>
          </select>
        </span>
          <span class="vert-divider">|</span>
          <span class="frameStatusText">
            <label for="id-frame">Current Frame:&nbsp;</label><input type="text" id="id-frame" value=0 class="currentFrameText" readonly>
            <span class="vert-divider">|</span>
            <label for="form-timestamp">Current Timestamp (hh:mm:ss:ff):&nbsp;</label>{{ form.timestamp }}
          </span>
        </div>
      </form>
    </div>
  </div>

  <hr>

  <!-- Camera Annotation List -->
  <div class="annotation-container" style="margin-left:20px;margin-top:20px">
    <h4>Camera Annotations
      <button id="export-all" class="controlButtonS" data-toggle="tooltip" data-placement="bottom"
              name="{% url 'export-annotations-xls' cameradata.id %}"
              value="{% url 'export-annotations-csv' cameradata.id %}"
              data-trigger="hover" title="Download annotations"><i class="material-icons">save_alt</i></button>
      <select id="export-format" class="downloadFormatDropDown" data-toggle="tooltip" data-placement="bottom"
              data-trigger="hover" title="Download format">
        <option value="1">Excel (.xls)</option>
        <option value="2">Comma-separated Values (.csv)</option>
      </select>

    </h4>
    <div class="annotation-objects">
      <ul id="annotation-objects-list">
        {% for annotation in cameradata.cameraannotation_set.all %}
          <li class="annotationDetails">
            <span class="annotationTimestamp">{{ annotation.timestamp }}</span>
            <button id="annotation_{{ annotation.id }}_rewind" class="controlButtonXS" name="{{ annotation.timestamp }}">
              <i class="material-icons" data-toggle="tooltip" data-placement="bottom" data-trigger="hover" style="font-size: 22px"
                 title="Jump to annotation">skip_previous</i>
            </button>
            {{ annotation.get_annotation_display }}{% if annotation.get_annotation_display == 'Other' %}: {{ annotation.note }}{% endif %}
            ({{ annotation.get_status_display }}) | {{ annotation.annotator }}
            {% if user.is_authenticated %}
              {% if annotation.annotator == user %}
                <button id="annotation_{{ annotation.id }}_edit" class="controlButtonXS"
                        name="{% url 'edit-camera-annotation' cameradata.id annotation.id|stringformat:"i" %}">
                  <i class="material-icons" data-toggle="tooltip" data-placement="bottom" data-trigger="hover" style="font-size: 22px"
                     title="Edit annotation">edit</i>
                </button>
              {% endif %}
            {% endif %}
            <em><a href="{{ annotation.get_absolute_url }}" data-toggle="tooltip" data-placement="bottom" data-trigger="hover"
                   title="Link to discussion page">({{ annotation.comments.count }}
              comment{% if annotation.comments.count != 1 %}s{% endif %})</a></em>
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>
{% endblock %}

{% block javascript %}
  <script src="{% static 'js/VideoFrame.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/cameradata_detail.js' %}"></script>
{% endblock %}

{% block jquery %}
  $('[data-toggle="tooltip"]').tooltip();
{% endblock %}